{% extends 'layout.html' %}
{% block title %}
  Researcher | Home
{% endblock %}

{% block contents %}

  <!-- hide mturk view for now  -->
  <div class="container">

    {% if users | length > 0 %}
      <div class="page-header">
        <h3>Participants</h3>
        <p>
          Total participants: 17
          <br>

          Fully connected: 8<br>
          Not connected at all: 3<br>
          Only RescueTime left: 4<br>
          Only Intervention App left: 2<br>
        </p>
      </div>

    {% else %}
      <div class="page-header">
        <h4>There are currently no Beehive users.</h4>
      </div>
    {% endif %}

    <div class="page-header">
      <h3>Experiments</h3>
    </div>

    <!-- Modal Button -->
    <button
      type="button"
      class="btn btn-primary"
      id="add-experiment-btn"
      data-toggle="modal"
      data-target="#add-experiment-modal">
      <span class="glyphicon glyphicon-plus"></span>
      Add Experiment
    </button>

    <!-- Modal -->
    <div
      class="modal fade"
      id="add-experiment-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="">New Experiment</h4>
          </div>
          <div class="modal-body">

            <div class="form-group row">
              <label for="example-text-input" class="col-xs-2 col-form-label">Title</label>
              <div class="col-xs-10">
                <input class="form-control" type="text" id="experiment-title-id">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">RescueTime required</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="rescuetime-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">Aware App required</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="aware-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

            <div class="page-header">
              <h4>
                Intervention App Features
              </h4>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">Geofence Feature</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="geofence-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">Text/Image Display</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="geofence-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">Alarm Reminder</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="alarm-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-search-input" class="col-xs-2 col-form-label">WiFi/<br>Vibration/<br>Media</label>
              <div class="col-xs-10">
                <input
                  type="checkbox"
                  id="geofence-checkbox-btn"
                  'unchecked'
                  data-toggle="toggle"
                  data-on="Yes"
                  data-off="No"
                  data-onstyle="success"
                  data-offstyle="danger">
              </div>
            </div>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Exit</button>
            <button type="button" class="btn btn-primary" id="create-experiment-btn">Create</button>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <div>
      <table class="table table-striped table-bordered">
        <tr>
          <th class="col-tiny-2">
            Edit/Delete
          </th>
          <th>
            Title
          </th>
          <th>
            Code
          </th>
          <th>
            RescueTime
          </th>
          <th>
            Aware App
          </th>
          <th>
            Geofence
          </th>
          <th>
            Text/Image
          </th>
          <th>
            Alarm/Reminder
          </th>
          <th>
            WiFi/Vibration/<br>Media Sounds
          </th>
        </tr>

        {% for study in studies %}
          <tr>
            <td>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                id="edit-experiment-btn"
                data-toggle="modal"
                data-target="#edit-experiment-modal">
                <span class="glyphicon glyphicon-pencil"></span>
              </button>

              <button
                type="button"
                class="btn btn-sm btn-danger"
                id="delete-experiment-btn"
                data-toggle="modal"
                data-target="#delete-experiment-modal">
                <span class="glyphicon glyphicon-trash"></span>
              </button>
            </td>

            <td>
              {{ study['title']}}
            </td>

            <td>
              {{ study['code']}}
            </td>
            <td class={{ 'success' if study['rescuetime'] == 'on' else 'danger'}}>
              {{ study['rescuetime']}}
            </td>
            <td class={{ 'success' if study['aware_app'] == 'on' else 'danger'}}>
              {{ study['aware_app']}}
            </td>
            <td class={{ 'success' if study['geofence'] == 'on' else 'danger'}}>
              {{ study['geofence']}}
            </td>
            <td class={{ 'success' if study['text_img'] == 'on' else 'danger'}}>
              {{ study['text_img']}}
            </td>
            <td class={{ 'success' if study['alarm_reminder'] == 'on' else 'danger'}}>
              {{ study['alarm_reminder']}}
            </td>
            <td class={{ 'success' if study['actuators'] == 'on' else 'danger'}}>
              {{ study['actuators']}}
            </td>
          </tr>
        {% endfor %}

      </table>
    </div>

    <div class="page-header">
      <h3>Interventions</h3>
    </div>

    <button
      type="button"
      class="btn btn-primary"
      id="add-experiment-btn"
      data-toggle="modal"
      data-target="#upload-image-modal">
      <span class="glyphicon glyphicon-plus"></span>
      New Image / Text
    </button>
    <div
      class="modal fade"
      id="upload-image-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="">Upload New Image / Text</h4>
          </div>
          <div class="modal-body">

            <form enctype="multipart/form-data">
              <input type="file" id="image" name="image" accept="Image/*"/>
              <br>
              <input type="submit" id="send-img-btn" value="Upload Image" class="btn btn-primary"/>
              <br>
              <span id="upload-status"></span>
            </form>

            <div class="page-header">
              <h4>Text</h4>
            </div>

            <form enctype="multipart/form-data">
              <textarea name="txt" id="txt" rows="4" cols="40"></textarea>
              <br>
              <input type="submit" id="send-txt-btn" value="Upload Text" class="btn btn-primary"/>
              <br>
              <span id="txt-status"></span>
            </form>

          </div>

        </div>
      </div>
    </div>

    <div class="page-header">
      <h4>Uploaded images and texts</h4>
      <input type="button" id="fetch-all-imgs-btn" value="Fetch All Images" class="btn btn-primary"/>
    </div>
    <div id="stored-img-div"></div>

    <div class="">

      <table class="table">
        <h3>data analysis</h3>

        <tr>
          <td>
            <div class="col-lg-8">

              <span class="dropdown">
                <strong>
                  Select datastream:
                </strong>
                <br>
                <span
                  class="btn btn-default dropdown-toggle"
                  type="button"
                  id="dropdown-action-label"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  Steps
                  <span class="caret"></span>
                </span>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="dropdown-action">
                  <li>
                    <a>Calories</a>
                  </li>
                  <li>
                    <a>Steps</a>
                  </li>
                  <li>
                    <a>Duration</a>
                  </li>
                </ul>
              </span>
              <br>
              <br>

            </div>
          </td>
        </tr>
      </table>
    </div>

    <div class="">

      <table class="table">
        <tr>
          <div class="col-lg-6">
            <strong>
              Select 4 dates in order:
            </strong>
            <em>
              Study Begin, Intervention Begin, Intervention End, Study End
            </em><br>
            <em>
              <small>NB: Max of
                <strong>31 days max</strong>
                b/w study start and end.
              </small>
            </em>
            <input
              data-provide="datepicker"
              data-date-end-date="-1d"
              data-date-format="yyyy-mm-dd"
              data-date-multidate=4
              data-date-multidate-separator=",   "
              data-date-today-highlight=true
              id="experiment-dates"
              class="form-control"
              placeholder="select four (4) dates">
            <br>
          </div>

        </tr>

        <tr>
          <td>
            <div class="col-lg-3">
              <button class="btn btn-primary" type="button" id="perform-analysis-btn">Perform Analysis</button>
            </div>
          </td>
        </tr>

      </table>

    </div>

    <div class="page-header">
      <h3>results</h3>
      <span class="danger" id="error-div"></span>
      <span id="analysis-status">Awaiting input...</span>
    </div>

    <div style="display: none">

      {% if mturk_users | length > 0 %}
        <div class="page-header">
          <h3>available mturk participants</h3>
        </div>

        <div>
          <table class="table table-striped">
            <tr>
              <th>
                NO
              </th>
              <th>
                Created
              </th>
              <th>
                Worker ID
              </th>
              <th>
                Moves ID
              </th>
              <th>
                Code
              </th>
              <th>
                IP
              </th>
            </tr>

            {% for muser in mturk_users %}
              <tr>
                <td>
                  worker{{loop.index}}
                </td>
                <td>
                  {{muser.created_at}}
                </td>
                <td>
                  {{muser.worker_id}}
                </td>
                <td>
                  {{ muser.moves_id }}
                </td>
                <td>
                  {{ muser.code }}
                </td>
                <td>
                  {{ muser.ip }}
                </td>
              </tr>
            {% endfor %}

          </table>

        {% else %}
          <div class="page-header">
            <h4>There are currently no Mturk users.</h4>
          </div>
        {% endif %}
      </div>

    </div>
  {% endblock %}
