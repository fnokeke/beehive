{% extends "layout.html" %}

{% block title %}
    {{ "Edit Experiment" if experiment else "New Experiment" }}
{% endblock %}

{% block contents %}

    <div>

        <button type="button" class="btn btn-link btn-lg" onclick="window.location.href='/researcher'">
            <span class="glyphicon glyphicon-triangle-left text-muted"></span>
            <span class="text-muted">
        Go Back
      </span>
        </button>

    </div>

    <div class="container">

        <div class="page-header">
            <h3>
                {{ "Edit Experiment" if experiment else "New Experiment" }}
            </h3>
        </div>

        <div class="row">
            <div class="col-xs-3">
                <button type="button" id="step1-basic" class="btn btn-lg btn-block btn-info" onclick="load_slide1()">1.
                    Basic Info
                </button>
            </div>
            <div class="col-xs-3">
                <button type="button" id="step2-data" class="btn btn-lg btn-block" onclick="load_slide2()">2. Data
                    Streams
                </button>
            </div>
            <div class="col-xs-3">
                <button type="button" id="step3-protocols" class="btn btn-lg btn-block" onclick="load_slide3()">3.
                    Protocols
                </button>
            </div>
            <div class="col-xs-3">
                <button type="button" id="step4-preview" class="btn btn-lg btn-block" onclick="load_slide4()">4.
                    Review
                </button>
            </div>
        </div>
        <br>

        <!--##################### slide1 #####################-->
        <div id="slide1" class="noshow">
            <h3>Basic Info</h3>
            <hr class="style5">
            <br>
            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Experiment Label</label>
                <div class="col-xs-8">
                    <input class="form-control"
                           type="text"
                           id="exp-label"
                           value="{{ experiment.label if experiment else '' }}"
                           placeholder="visible to only you"
                    />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Experiment Title</label>
                <div class="col-xs-8">
                    <input
                            class="form-control"
                            type="text"
                            id="exp-title"
                            value="{{ experiment.title if experiment else '' }}"
                            placeholder="experiment title will be visible to participants"/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Experiment Description</label>
                <div class="col-xs-8">
                    <input class="form-control"
                           type="text"
                           value="{{ experiment.description if experiment else '' }}"
                           id="exp-description"
                           placeholder="brief summary visible to participants">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Start Date</label>
                <div class="col-xs-8">
                    <input
                            class="form-control"
                            id="exp-start-date"
                            data-provide="datepicker"
                            data-date-start-date="{{ today_date }}"
                            data-date-format="yyyy-mm-dd"
                            data-date-today-highlight="true"
                            value="{{ experiment.start_date | onlydatefmt if experiment else today_date }}"
                    />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">End Date</label>
                <div class="col-xs-8">
                    <input
                            class="form-control"
                            id="exp-end-date"
                            data-provide="datepicker"
                            data-date-start-date="{{ today_date }}"
                            data-date-format="yyyy-mm-dd"
                            data-date-today-highlight="true"
                            value="{{ experiment.end_date | onlydatefmt if experiment else today_date }}"
                    />
                </div>
            </div>

            <br/>
            <div class="text-center">
                <button type="button"
                        class="btn btn-primary btn-lg"
                        onclick="load_slide2()">
                    <span> &nbsp &nbsp Next </span>
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    <span> &nbsp &nbsp </span>
                </button>
            </div>

            <br/>
        </div>

        <!--##################### slide2 #####################-->
        <div id="slide2" class="noshow">

            <h3>Data Streams</h3>
            <hr class="style5">
            <br>
            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Screen events</label>
                <div class="col-xs-10">
                    <input
                            type="checkbox"
                            id="exp-screen-events"
                            {{ 'checked' if experiment and experiment.screen_events else '' }}
                            data-toggle="toggle"
                            data-on="Yes"
                            data-off="No"
                            data-onstyle="primary"
                            data-offstyle="danger"
                    >
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">App usage</label>
                <div class="col-xs-10">
                    <input
                            type="checkbox"
                            {{ 'checked' if experiment and experiment.app_usage else '' }}
                            id="exp-app-usage"
                            data-toggle="toggle"
                            data-on="Yes"
                            data-off="No"
                            data-onstyle="primary"
                            data-offstyle="danger"
                    >
                </div>
            </div>

            <br/>
            <div class="text-center">
                <button type="button"
                        class="btn btn-primary btn-lg"
                        onclick="load_slide3()">
                    <span> &nbsp &nbsp Next </span>
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    <span> &nbsp &nbsp </span>
                </button>
            </div>
            <br/>
        </div>

        <!--##################### slide3 #####################-->
        <div id="slide3" class="noshow">
            <h3>Protocols</h3>
            <hr class="style5">
            <br>

            <div class="col-xs-4">
                <button type="button"
                        class="btn btn-primary"
                        id="add-protocol-button"
                        data-toggle="modal"
                        data-target="#add-protocol-modal">
                    <span class="glyphicon glyphicon-plus-sign"></span>
                    Add Protocol
                </button>
            </div>
            <hr>

            <div id="display-protocols">
                <br/>
                <span id="protocols-list-view"></span>
                <span id="protocols-error-view"></span>
                <br/>
            </div>

            <br/>
            <div class="text-center">
                <button type="button"
                        class="btn btn-primary btn-lg"
                        onclick="load_slide4()">
                    <span> &nbsp &nbsp Next </span>
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    <span> &nbsp &nbsp </span>
                </button>
            </div>
            <br/>
        </div>


        <!--##################### slide4 #####################-->
        <div id="slide4" class="noshow">
            <h3>Review & Launch</h3>
            <div>
                Review experiment settings before you approve and create it.
            </div>
            <hr class="style5">


            <!--------------------------- Section 1 --------------------------->

            <div>
                <span class="review-section-title">Basic Info</span>
                <button type="button" onclick="load_slide1()" class="btn btn-info float-i-right">&nbsp; Edit &nbsp;</button>
            </div>
            <br>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Label</label>
                <div class="col-xs-8">
                    <input maxlength="120" type="text" id="review-label" class="form-control classname" value="Demo"
                           readonly/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Title</label>
                <div class="col-xs-8">
                    <input maxlength="120" type="text" id="review-title" class="form-control classname" value="Demo"
                           readonly/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Description</label>
                <div class="col-xs-8">
                    <input maxlength="250" type="text" id="review-description" class="form-control classname"
                           value="Demo" readonly/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">Start Date</label>
                <div class="col-xs-8">
                    <input type="text" id="review-start-date" class="form-control classname" value="Demo" readonly/>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-xs-2 col-form-label">End Date</label>
                <div class="col-xs-8">
                    <input type="text" id="review-end-date" class="form-control classname" value="Demo" readonly/>
                </div>
            </div>

            <hr class="style5">

            <!--------------------------- Section 2 --------------------------->
            <div>
                <span class="review-section-title">Data Streams</span>
                <button type="button" onclick="load_slide2()" class="btn btn-info float-i-right">&nbsp; Edit &nbsp;</button>
            </div>
            <br>

            <div class="form-group row" id="review-screen-events-btn">
                <label class="col-xs-2 col-form-label">Screen Events</label>
                <button type="button" class="btn btn-primary">&nbsp; ON &nbsp;</button>
            </div>


            <div class="form-group row" id="review-app-usage-btn">
                <label class="col-xs-2 col-form-label">App usage</label>
                <button type="button" class="btn btn-primary">&nbsp; ON &nbsp;</button>
            </div>

            <div id="review-data-streams">
                <br/>
                <span id="review-data-streams-msg"></span>
                <br/>
            </div>
            <hr class="style5">

            <!--------------------------- Section 3 --------------------------->
            <div>
                <span class="review-section-title">Protocols</span>
                <button type="button" onclick="load_slide3()" class="btn btn-info float-i-right">&nbsp; Edit &nbsp;</button>
            </div>
            <br>

            <div id="review-protocols">
                <br/>
                <span id="review-protocols-list-view"></span>
                <span id="review-protocols-error-view"></span>
                <br/>
            </div>

            <hr class="style5">

            <!--------------------------- Submit --------------------------->

            <div class="text-center">
                <button type="button"
                        class="btn btn-primary btn-lg"
                        id="create_experiment_btn"
                        onclick="create_experiment_handler()">
                    <span class="glyphicon glyphicon-ok"></span>
                    Launch experiment
                </button>
                <input type="text" class="noshow" value="{{ current_user.email }}" id="exp-owner">

            </div>

            <br>

            <div class="text-center" id="review-experiment-view">
                <span id="review-experiment-success"></span>
                <span id="review-experiment-error"></span>
            </div>

        </div>


        <!--##################### slide5 #####################-->
        <div id="slide5" class="noshow">
            <br/>
            <br/>
            <div class="text-center text-success"><h4> Data Submitted Successfully </h4></div>
            <br/>
        </div>

        <div>
            <br/>
            <hr/>
        </div>


        <!--##################### Add Protocol Modal  #####################-->
        <div
                class="modal fade"
                tabindex="-1"
                id="add-protocol-modal"
                role="dialog"
                aria-labelledby="myModalLabel">

            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4 class="modal-title">Add Protocol
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h4>
                    </div>

                    <div class="modal-body">
                        <div class="form-group row">
                            <label class="col-xs-2 col-form-label">Label</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" placeholder="label to identify the protocol"
                                       id="protocol-label">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-xs-2 col-form-label">Dates</label>
                            <div class="col-xs-10">
                                <div class="input-group input-daterange">
                                    <input
                                            type="text"
                                            id="protocol-start-date"
                                            class="form-control"
                                            placeholder="yyyy-mm-dd"
                                            data-date-start-date="{{ today_date }}"
                                            data-date-today-highlight=true
                                            data-date-format='yyyy-mm-dd'
                                            value="{{ today_date }}">

                                    <div class="input-group-addon">to</div>
                                    <input
                                            type="text"
                                            id="protocol-end-date"
                                            class="form-control"
                                            placeholder="yyyy-mm-dd"
                                            data-date-start-date="{{ today_date }}"
                                            data-date-today-highlight=true
                                            data-date-format='yyyy-mm-dd'
                                            value="{{ today_date }}">
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-xs-2 col-form-label">Frequency</label>
                            <div class="col-xs-10">
                                <select class="form-control" id="protocol-frequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Biweekly</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-xs-2 col-form-label">Method</label>
                            <div class="col-xs-10">
                                <select class="form-control" id="protocol-method">
                                    <option value="none">None</option>
                                    <option value="email">Email</option>
                                    <option value="push_notification">Push Notification</option>
                                    <option value="vibration">Vibration</option>
                                </select>
                            </div>
                        </div>


                        <div id="notification-types" class="hidden">

                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">Title</label>
                                <div class="col-xs-10">
                                    <input maxlength="15" class="form-control" type="text"
                                           placeholder="title of notification (max: 15 characters)"
                                           id="protocol-notif-title">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">Content</label>
                                <div class="col-xs-10">
                                    <input maxlength="20" class="form-control" type="text"
                                           placeholder="content of notification (max: 20 characters)"
                                           id="protocol-notif-content">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">App ID</label>
                                <div class="col-xs-5">
                                    <input class="form-control" type="text" placeholder="e.g. com.facebook.katana"
                                           id="protocol-notif-appid">
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">Notification type</label>
                                <div class="col-xs-5">
                                    <select class="form-control" id="protocol-options-notif-type">
                                        <option value="fixed">Fixed time</option>
                                        <option value="user_window">User window</option>
                                        <option value="sleep_wake">Sleep/Wake</option>
                                    </select>
                                </div>
                            </div>

                            <div id="div-notif-fixed">
                                <div class="form-group row">
                                    <label class="col-xs-2 col-form-label">Time</label>
                                    <div class="col-xs-5">
                                        <input class="form-control" type="time" name="protocol-fixed-exact-time"
                                               value="12:00:00"
                                               id="protocol-fixed-exact-time">
                                    </div>
                                </div>

                            </div>

                            <div id="div-notif-user-window" class="hidden">
                                <div class="form-group row">
                                    <label class="col-xs-2 col-form-label">Time</label>
                                    <div class="col-xs-5">
                                        <select class="form-control" id="notification-user-time-options">
                                            <option value="1_hour">1 hour</option>
                                            <option value="2_hour">2 hours</option>
                                            <option value="3_hour">3 hours</option>
                                            <option value="4_hour">4 hours</option>
                                            <option value="5_hour">5 hours</option>
                                            <option value="6_hour">6 hours</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="div-notif-sleep-awake" class="hidden">
                                <div class="form-group row">
                                    <label class="col-xs-2 col-form-label">Time</label>
                                    <div class="col-xs-5">
                                        <select class="form-control" id="notification-sleep-time-options">
                                            <option value="1_hour">1 hour</option>
                                            <option value="2_hour">2 hours</option>
                                            <option value="3_hour">3 hours</option>
                                            <option value="4_hour">4 hours</option>
                                            <option value="5_hour">5 hours</option>
                                            <option value="6_hour">6 hours</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-xs-2 col-form-label">Sleep/Awake</label>
                                    <div class="col-xs-5">
                                        <select class="form-control" id="protocol-notif-sleep-awake">
                                            <option value="before_sleep">Before sleep</option>
                                            <option value="after_wakeup">After waking-up</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">Half notify</label>
                                <div class="col-xs-10">
                                    <div class="material-switch">
                                        <input id="probable-half-notify" name="someSwitchOption001"
                                               type="checkbox"/>
                                        <label for="probable-half-notify" class="label-info"> </label>
                                        &nbsp; &nbsp; (push notification only 50% of the time)
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div id="protocol-date-time" class="hidden">
                            <div class="form-group row">
                                <label class="col-xs-2 col-form-label">Time</label>
                                <div class="col-xs-10">
                                    <div class="input-group input-timerange">
                                        <input class="form-control" type="time" name="start-time" value="12:00:00"
                                               id="protocol-start-time">
                                        <div class="input-group-addon">to</div>
                                        <input class="form-control" type="time" name="end-time" value="15:00:00"
                                               id="protocol-end-time">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="create-protocol-btn"
                                onclick="create_protocol_handler()">Create
                        </button>
                    </div>

                </div>
            </div>
        </div>

    </div>

{% endblock %}
